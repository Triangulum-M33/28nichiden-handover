.. meta::
   :ROBOTS: NOINDEX,NOFOLLOW,NOARCHIVE

無線制御(Acrab)
===============

-  書いた人：Kenichi Ito(nichiden\_27)
-  更新日時：2017/3/20
-  実行に必要な知識・技能：Web制作、JavaScript
-  タスクの重さ: 4/一月はかかる
-  タスクの必須度：4/毎年やるべき
-  元資料
-  ``星座絵送信機・受信機資料.pdf`` by 岩滝宗一郎(nichiden\_22)

概要
----

沿革
----

星座絵は、プラネのにとって重要な要素だが、常に点けたままというわけにはいかない。
解説やソフトの流れに合わせてたくさんの星座絵をリアルタイムでオンオフできる必要がある。

ただし、星座絵投影機の本体は、他の主投影機同様日周緯度変装置により回転する。
有線での制御は不可能に近い。
そこで、日電では星座絵の制御に無線を採用してきた。

16-21主投
~~~~~~~~~

データとして共有されている限りの資料では、16日電が\ **FM変調方式**
の電波を採用していた。
FMとは周波数変調方式のことで、ある周波数を閾値として0か1かのデジタル信号を表すというわけだ。
ただし、高周波のノイズが紛れ込むと0が1に反転してしまう問題があり、誤り訂正の工夫をしていたようだ。

この頃の情報は不完全で、不明なことも多い。
19日電の資料には、北天側で信号を受信し、南天側のサブ機に有線で信号を送ったとの記述がある。
送信機・受信機にはPICマイコンを使っていたようだ。

22主投
~~~~~~

22では、AM変調の無線モジュールとAVRマイコンを採用した。 英RF
Solutions社の\ ``AM-RT``/``AM-HRR``\ というモジュールを使用していたようだ。

22星座絵は16個あり、16bit(2byte)のデータでオンオフを表現できる。
送信側はトグルスイッチ16個を並べた基板と接続しており、スイッチの状態を読み取って電波信号に換える。

南北の受信機の区別にも工夫があった。
ジャンパピンの位置で、上位・下位それぞれ8bitのどちらを読み取るか切り替えられる。
これにより、送信側からは南北まとめて信号を送り、受信側で南北を区別する仕組みだ。

.. figure:: _media/wireless-22.jpg
   :alt: 22星座絵受信機に貼られていたラベル

   22星座絵受信機に貼られていたラベル

しかし、通信のエラーは排除しきれず、タイムラグも大きいものだった。

23主投
~~~~~~

23主投になり、\ ``XBee``\ **が初めて採用された。**
``Xbee``\ は、\ ``ZigBee``\ というプロトコルを使用した無線モジュールだ。
買ってきて設定するだけで、手軽に無線通信を使用できる。
ロボットやCanSat(模擬人工衛星)の大会でも多数のチームが採用しており、性能は折り紙つきである。

``XBee``\ にはシリアル通信のように扱えるATモードと、\ ``XBee``\ 自体を制御に使うAPIモードがある。
23で使ったのは前者で、送信側1台をPCに、受信側2台を南北それぞれの受信機回路に接続していた。

23では、これまでのように一方的にコマンドを送るだけでなく、\ **受信側の状態をフィードバック**
することでエラー検出・修正を試みた。
しかし、回路の不備で正しい応答が返らず、星座絵の操作はできたもののフィードバックは実現しなかった。

受信機の回路には22同様AVRが使われた。
さらに、過電圧保護回路やトランジスタアレイでのポート制御など、以降の星座絵受信機の基本となる設計がこの時期に生み出された。
